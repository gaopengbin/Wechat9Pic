# 需求文档

## 简介

3D立体效果功能是微信九宫格编辑器的核心特色功能，通过"九宫格底图 + 前景主体抠图"的双层叠加设计，结合位置错位、阴影和透视辅助，营造出"前景主体悬浮于九宫格之上，甚至部分冲出九宫格边框"的立体层次感。该功能无需3D引擎，纯前端Canvas技术即可实现，操作简单且效果直观。

## 术语表

- **九宫格底图（Grid Background）**：由9张图片按3×3网格排列组成的1:1比例背景图，带有清晰的格子边框
- **前景主体（Foreground Subject）**：从原图中抠取的主要对象（人物/物体），具有透明背景
- **AI抠图服务（AI Matting Service）**：使用深度学习模型自动分离图片主体与背景的服务
- **图层合成（Layer Composition）**：将多个图层按顺序叠加渲染成最终图片的过程
- **投影效果（Shadow Effect）**：为前景主体添加的阴影，增强立体悬浮感
- **边框溢出（Border Overflow）**：前景主体部分超出九宫格边框的视觉效果

## 需求

### 需求 1

**用户故事：** 作为用户，我想要生成带有清晰边框的九宫格底图，以便作为3D效果的背景层

#### 验收标准

1. WHEN 用户上传9张图片 THEN 九宫格编辑器 SHALL 自动生成1080×1080像素的九宫格底图
2. WHEN 生成九宫格底图 THEN 九宫格编辑器 SHALL 为每个格子添加2-4像素宽度的白色边框
3. WHEN 图片尺寸不一致 THEN 九宫格编辑器 SHALL 自动裁剪图片为正方形并居中显示
4. WHEN 用户调整边框宽度 THEN 九宫格编辑器 SHALL 提供1-10像素的边框宽度选项
5. WHEN 用户选择边框颜色 THEN 九宫格编辑器 SHALL 提供白色、黑色和自定义颜色选项

### 需求 2

**用户故事：** 作为用户，我想要一键抠取图片中的主体，以便将其作为前景层叠加到九宫格上

#### 验收标准

1. WHEN 用户上传主体图片 THEN AI抠图服务 SHALL 在3秒内完成主体分离
2. WHEN AI抠图完成 THEN 九宫格编辑器 SHALL 输出带透明背景的PNG格式主体图
3. WHEN 抠图结果包含发丝等细节 THEN AI抠图服务 SHALL 保留边缘细节，避免锯齿
4. WHEN 用户对抠图结果不满意 THEN 九宫格编辑器 SHALL 提供简易橡皮擦工具进行手动修正
5. WHEN 抠图失败或超时 THEN 九宫格编辑器 SHALL 显示错误提示并允许重试

### 需求 3

**用户故事：** 作为用户，我想要自由调整前景主体的位置和大小，以便实现主体"冲出"九宫格边框的效果

#### 验收标准

1. WHEN 用户拖动前景主体 THEN 九宫格编辑器 SHALL 允许主体移动到任意位置，包括超出九宫格边界
2. WHEN 用户缩放前景主体 THEN 九宫格编辑器 SHALL 支持10%-300%的缩放范围
3. WHEN 用户旋转前景主体 THEN 九宫格编辑器 SHALL 支持±180度的旋转角度
4. WHEN 用户调整主体位置 THEN 九宫格编辑器 SHALL 实时更新预览显示
5. WHEN 主体部分超出画布边界 THEN 九宫格编辑器 SHALL 在导出时裁剪超出部分

### 需求 4

**用户故事：** 作为用户，我想要为前景主体添加投影效果，以便增强立体悬浮感

#### 验收标准

1. WHEN 用户启用投影效果 THEN 九宫格编辑器 SHALL 为前景主体添加高斯模糊阴影
2. WHEN 用户调整阴影模糊度 THEN 九宫格编辑器 SHALL 提供0-30像素的模糊度滑块
3. WHEN 用户调整阴影偏移 THEN 九宫格编辑器 SHALL 支持X/Y方向各-50到+50像素的偏移
4. WHEN 用户调整阴影透明度 THEN 九宫格编辑器 SHALL 提供0%-100%的透明度滑块
5. WHEN 用户选择阴影颜色 THEN 九宫格编辑器 SHALL 默认使用黑色，支持自定义颜色

### 需求 5

**用户故事：** 作为用户，我想要支持多个前景主体叠加，以便创建更丰富的立体效果

#### 验收标准

1. WHEN 用户添加多个前景主体 THEN 九宫格编辑器 SHALL 支持最多5个主体图层
2. WHEN 存在多个主体图层 THEN 九宫格编辑器 SHALL 显示图层列表并支持拖拽排序
3. WHEN 用户选择某个图层 THEN 九宫格编辑器 SHALL 高亮显示该图层并允许单独编辑
4. WHEN 用户删除某个图层 THEN 九宫格编辑器 SHALL 从画布中移除该主体并更新预览
5. WHEN 用户调整图层顺序 THEN 九宫格编辑器 SHALL 按新顺序重新渲染所有图层

### 需求 6

**用户故事：** 作为用户，我想要调整前景主体的透明度，以便让主体与底图融合更自然

#### 验收标准

1. WHEN 用户调整主体透明度 THEN 九宫格编辑器 SHALL 提供0%-100%的透明度滑块
2. WHEN 透明度设置为100% THEN 九宫格编辑器 SHALL 显示完全不透明的主体
3. WHEN 透明度设置为0% THEN 九宫格编辑器 SHALL 完全隐藏该主体
4. WHEN 用户调整透明度 THEN 九宫格编辑器 SHALL 在200毫秒内更新预览显示
5. WHEN 导出图片 THEN 九宫格编辑器 SHALL 保留设置的透明度效果

### 需求 7

**用户故事：** 作为用户，我想要将所有图层合成并导出为高清图片，以便分享到社交媒体

#### 验收标准

1. WHEN 用户点击导出 THEN 九宫格编辑器 SHALL 将所有图层合成为单张1080×1080像素图片
2. WHEN 合成图片 THEN 九宫格编辑器 SHALL 按图层顺序正确渲染（底图→主体1→主体2...）
3. WHEN 导出完成 THEN 九宫格编辑器 SHALL 生成JPEG格式图片，质量不低于90%
4. WHEN 主体超出画布边界 THEN 九宫格编辑器 SHALL 裁剪超出部分，保持1:1比例
5. WHEN 导出过程中 THEN 九宫格编辑器 SHALL 显示进度指示器

### 需求 8

**用户故事：** 作为用户，我想要实时预览3D立体效果，以便在导出前确认满意

#### 验收标准

1. WHEN 用户修改任何参数 THEN 九宫格编辑器 SHALL 在300毫秒内更新预览
2. WHEN 用户点击全屏预览 THEN 九宫格编辑器 SHALL 以全屏模式显示最终效果
3. WHEN 全屏预览模式 THEN 九宫格编辑器 SHALL 隐藏所有编辑控件
4. WHEN 用户退出全屏预览 THEN 九宫格编辑器 SHALL 恢复编辑界面
5. WHEN 预览渲染 THEN 九宫格编辑器 SHALL 使用与导出相同的渲染逻辑

